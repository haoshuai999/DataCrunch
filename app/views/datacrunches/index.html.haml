- if params[:user_login]
  %div.row
    %div.col-md-3
      %p= "Hello, " + params[:user_login]
    %div.col-md-3
      = form_tag datacrunches_path(params[:user_login] => nil), :method => 'get' do
        = submit_tag 'Log out', :class => 'btn btn-warning btn-sm', :id => 'logout'
  %div.row
    %div.col-md-12
      = form_tag datacrunches_showall_path, :method => 'get' do
        = submit_tag 'Show all datacrunches', :class => 'btn btn-primary', :id => 'showall'
- else
  %div.row
    %div.col-md-9
      = form_tag datacrunches_path, :id => "login_form" do

        = label :user, :username, 'User Name'
        = text_field :user, 'username', value: params[:username]

        = label :user, :password, 'Password'
        = text_field :user, "password"

        = submit_tag 'Log in', :class => 'btn btn-primary'
    %div.col-md-3
      = form_tag new_user_path, :method => 'get' do

        = submit_tag 'Sign up', :class => 'btn btn-primary'
%div.row
  %div.col-md-12 
    %h1 Data Crunch

%div.row
  %div.col-md-12 
    = form_for :datacrunch, url: datacrunches_path, :class =>'upload-form', html: { multipart: true} do |form|
      = form.file_field :data, accept: '.csv, .json, .xlsx', :required => true
      -# = file_field_tag 'Upload', :data, accept: '.csv, .json, .xlsx', :required => true

      = label :datacrunch, :title, 'Title'
      = text_field :datacrunch, 'title', :required => true

      = label :datacrunch, :description, 'Description'
      = text_field :datacrunch, "description"

      - if params[:user_login]
        = label :datacrunch, :publicity, 'Publicity'
        = select :datacrunch, :publicity, [['public', true], ['private', false]]

      = submit_tag 'Upload', :class => 'btn btn-primary'


-# #flash-display
-#   - flash.each do |type, msg|
-#     %div{:class => "alert alert-#{type == :notice ? "success" : type} fadeout", "data-dismiss" => "alert"}
-#       = sanitize(msg) if msg.is_a?(String)
- flash.each do |type, msg|
  %div
    = sanitize(msg) if msg.is_a?(String)

%table.table
  %thead
    %tr 
      %th Title
      %th Descrption
      %th File_Name
      %th User
      %th Created_Time
      %th More Info
      %th Publicity
  %tbody
    - @datacrunches.each do |crunch|
      %tr
        %td= crunch.title
        %td= crunch.description
        %td= crunch.data_file_name
        %td= crunch.username
        %td= crunch.created_at
        -# %td.datacrunch_link= link_to "More about #{crunch.title}", datacrunch_path(crunch), :id => "crunch_#{crunch.id}", :method => "get"
        %td= crunch.publicity ? "public" : "private"